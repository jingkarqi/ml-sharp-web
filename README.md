# 空间照片一键启动包

这是一个基于 Apple SHARP 模型的本地 Web 封装：一张图片即可生成 3D Gaussian 的 `.ply`，并用内置 Viewer 直接查看。  
面向有基础但不想折腾环境的用户，提供一键初始化与启动流程。

## 快速开始（推荐）

1. 双击运行 `init.bat`（首次使用建议先跑一次）
   - 自动检查/创建虚拟环境  
   - 检查模型权重（缺失会询问是否下载）  
   - 检查依赖并按需安装  
   - 选择推理方式（CPU / GPU-CUDA）
2. 初始化完成后，双击 `start.bat` 启动服务  
3. 浏览器会自动打开首页（默认地址 `http://127.0.0.1:7860/`）

## 使用流程

1. 首页选择/拖拽图片  
2. 点击“开始生成”  
3. 生成后点击“打开 Viewer”查看模型  
4. 首页下方“已生成模型”支持：查看 / 重命名 / 删除

## 模型权重说明（必读）

- 默认权重路径：`src/models/sharp_2572gikvuh.pt`  
- `init.bat` 会提示是否下载；如果拒绝，请手动将模型放入上述路径  
- 服务器不会自动下载模型，避免误耗流量

## 运行环境建议

- Windows 10/11  
- Python 3.9+（已在 3.13 测试）  
- 推荐 NVIDIA 显卡 + CUDA 驱动（4060 Laptop 10~20s一张图，图片像素越高耗时越长）  
- 纯 CPU 也可运行，但速度较慢

## 常用脚本

- 初始化（一次即可）：`init.bat`  
- 启动服务：`start.bat`  

> 提示：启动后会自动打开浏览器。如需关闭自动打开，可设置环境变量 `SHARP_NO_BROWSER=1`。

## 目录结构

```
.
├─ app/                 # Web 服务端
├─ page/                # 首页（上传/状态/模型列表）
├─ viewer/              # 预构建 3D Viewer（勿修改）
├─ src/sharp/           # SHARP 核心模型
├─ input/               # 上传图片临时保存
├─ output/              # 生成的 .ply 输出
├─ init.bat             # 一键初始化（推荐）
├─ start.bat            # 启动服务
├─ check_env.py         # 环境检查脚本
├─ init_env.py          # 初始化脚本
└─ requirements.txt
```

## 常见问题

**1) 为什么显示缺少依赖，但还能运行？**  
部分依赖是“可选功能”（例如 HEIC 支持、下载加速）。如果你只用 JPG/PNG 且本地已有模型，可以先不装。

**2) 为什么推理用的是 CPU？**  
请确认 CUDA 版 torch 已安装，且 `torch.cuda.is_available()` 为 True。  
如果你选择了 GPU，但系统未检测到显卡驱动，会提示确认。

**3) 生成的模型在哪里？**  
在 `output/` 文件夹，文件后缀为 `.ply`。

**4) 关闭页面后服务为什么停了？**  
首页关闭会通知服务自动退出，避免后台残留进程。

## 注意事项

- 服务器仅用于本地运行，不建议对外网开放  
- 生成过程依赖显存/内存，建议关闭占用 GPU 的程序

## 卸载 / 清理

如需完全清理本项目运行痕迹，可删除：

- `.venv/`（虚拟环境）  
- `input/`（图片加载缓存）  
- `output/`（生成结果）  
- `output/env_report.txt`（环境报告）

## 许可证

模型与核心代码来源于 Apple SHARP 项目，遵循其原始许可证约束。  
本仓库是本地 Web 封装与脚本化便捷工具。
